<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weighbridge Software with Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .slip-font { font-family: 'Roboto Mono', monospace; }
        #saved-slips-list::-webkit-scrollbar { width: 8px; }
        #saved-slips-list::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        #saved-slips-list::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        #saved-slips-list::-webkit-scrollbar-thumb:hover { background: #555; }
        @media print {
            body * { visibility: hidden; }
            #slip-preview-container, #slip-preview-container * { visibility: visible; }
            #slip-preview-container { position: absolute; left: 0; top: 0; width: 100%; height: auto; margin: 0; padding: 15px; border: none; box-shadow: none; }
            .no-print { display: none; }
        }
        input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(0.6); }
        .toast { visibility: hidden; min-width: 250px; margin-left: -125px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 10; left: 50%; bottom: 30px; opacity: 0; transition: opacity 0.5s, visibility 0.5s; }
        .toast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- Authentication Container -->
    <div id="auth-container" class="min-h-screen flex items-center justify-center">
        <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-lg">
            <!-- Login Form -->
            <form id="login-form">
                <h2 class="text-3xl font-bold text-center text-slate-800 mb-2">Welcome Back!</h2>
                <p class="text-center text-slate-500 mb-6">Sign in to continue</p>
                <div class="space-y-4">
                    <input type="email" id="login-email" placeholder="Email" required class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <input type="password" id="login-password" placeholder="Password" required class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <button type="submit" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-all">Login</button>
                <p class="text-center text-sm text-slate-500 mt-4">
                    Don't have an account? <a href="#" id="show-signup" class="font-semibold text-blue-600 hover:underline">Sign Up</a>
                </p>
            </form>
            <!-- Signup Form (hidden by default) -->
            <form id="signup-form" class="hidden">
                 <h2 class="text-3xl font-bold text-center text-slate-800 mb-2">Create Account</h2>
                <p class="text-center text-slate-500 mb-6">Get started with your weighbridge app</p>
                <div class="space-y-4">
                    <input type="email" id="signup-email" placeholder="Email" required class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <input type="password" id="signup-password" placeholder="Password (min. 6 characters)" required class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <button type="submit" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-all">Sign Up</button>
                <p class="text-center text-sm text-slate-500 mt-4">
                    Already have an account? <a href="#" id="show-login" class="font-semibold text-blue-600 hover:underline">Login</a>
                </p>
            </form>
        </div>
    </div>
    
    <!-- Main App Container (hidden by default) -->
    <div id="app-container" class="hidden">
        <header class="bg-white shadow-md p-4 no-print">
            <div class="container mx-auto flex justify-between items-center">
                <p class="text-sm">Logged in as: <strong id="user-email" class="text-slate-700"></strong></p>
                <button id="logout-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 transition-all text-sm">Logout</button>
            </div>
        </header>
        <div class="container mx-auto p-4 md:p-8">
             <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Input Form is here -->
                 <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg no-print">
                     <form id="weighbridge-form" class="space-y-6">
                         <!-- All form sections are identical to the previous version -->
                         <!-- Company -->
                         <div>
                            <h3 class="text-lg font-semibold border-b pb-2 mb-4 text-slate-700">Company & Weighbridge</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><input type="text" id="company-name" placeholder="Your Company Name" class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none" value="ASHAPURA ENTERPRISE"><input type="text" id="weighbridge-name" placeholder="Weighbridge Name/Location" class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none" value="Main Yard, Rajkot"></div>
                         </div>
                         <!-- Slip Details -->
                         <div>
                             <h3 class="text-lg font-semibold border-b pb-2 mb-4 text-slate-700">Slip & Time Details</h3>
                             <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                 <div class="col-span-2 sm:col-span-4"><label for="serial-no" class="text-sm font-medium text-slate-600">Serial No / DC No.</label><input type="text" id="serial-no" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                                 <div><label for="in-date" class="text-sm font-medium text-slate-600">In Date</label><input type="date" id="in-date" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                                 <div><label for="in-time" class="text-sm font-medium text-slate-600">In Time</label><input type="time" id="in-time" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                                 <div><label for="out-date" class="text-sm font-medium text-slate-600">Out Date</label><input type="date" id="out-date" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                                 <div><label for="out-time" class="text-sm font-medium text-slate-600">Out Time</label><input type="time" id="out-time" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                             </div>
                         </div>
                         <!-- Transaction -->
                         <div>
                             <h3 class="text-lg font-semibold border-b pb-2 mb-4 text-slate-700">Transaction Details</h3>
                             <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><input type="text" id="customer-name" placeholder="Customer Name" class="sm:col-span-2 w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"><input type="text" id="site" placeholder="Site" class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"><input type="text" id="vehicle-number" placeholder="Vehicle Number" class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"><input type="text" id="item-name" placeholder="Item/Material" class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"><input type="text" id="royalty-pass-no" placeholder="Royalty Pass No." class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"><input type="text" id="driver-name" placeholder="Driver's Name" class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"><input type="number" id="charges" placeholder="Weighment Charges (₹)" class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                         </div>
                         <!-- Weight -->
                         <div>
                            <h3 class="text-lg font-semibold border-b pb-2 mb-4 text-slate-700">Weight Details (in KG)</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><input type="number" id="gross-weight" placeholder="Gross Weight" class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"><input type="number" id="tare-weight" placeholder="Tare Weight" class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                         </div>
                         <div class="pt-4 grid grid-cols-2 gap-4">
                             <button type="button" id="new-slip-btn" class="w-full bg-slate-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-600">New Slip</button>
                             <button type="button" id="save-print-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                                Save & Print Slip
                             </button>
                         </div>
                     </form>
                 </div>
                 <!-- Slip Preview is here -->
                 <div id="slip-preview-container" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border-2 border-dashed border-slate-300">
                    <!-- Slip preview content is identical to previous version -->
                    <div id="slip-preview" class="flex flex-col h-full"><div class="text-center"><h2 id="preview-company-name" class="text-2xl font-bold text-slate-900">ASHAPURA ENTERPRISE</h2><p id="preview-weighbridge-name" class="text-sm text-slate-500">Main Yard, Rajkot</p></div><div class="flex justify-between items-center mt-2 border-y-2 border-black py-1"><h3 class="text-md font-bold">WEIGHMENT SLIP</h3><p class="text-xs font-semibold">Customer Copy</p></div><div class="slip-font text-sm grid grid-cols-2 gap-x-4 mt-2 border-b border-black pb-2"><div><div class="flex justify-between pr-4"><span>Serial No:</span><strong id="preview-serial-no"></strong></div></div><div class="space-y-1"><div class="flex justify-between"><span class="pr-2">In Date/Time:</span><strong id="preview-in-datetime"></strong></div><div class="flex justify-between"><span class="pr-2">Out Date/Time:</span><strong id="preview-out-datetime"></strong></div></div></div><div class="slip-font text-sm grid grid-cols-2 gap-x-8 gap-y-1 my-2 py-2 border-b border-black"><div class="flex justify-between"><span>Customer:</span> <strong id="preview-customer-name"></strong></div><div class="flex justify-between"><span>Gross (KG):</span> <strong id="preview-gross-weight" class="text-lg">0</strong></div><div class="flex justify-between"><span>Site:</span> <strong id="preview-site"></strong></div><div class="flex justify-between"><span>Tare (KG):</span> <strong id="preview-tare-weight" class="text-lg">0</strong></div><div class="flex justify-between"><span>Vehicle No:</span> <strong id="preview-vehicle-number" class="uppercase"></strong></div><div class="flex justify-between border-t border-dashed pt-1"><span>Net (KG):</span> <strong id="preview-net-weight" class="text-xl">0</strong></div><div class="flex justify-between"><span>Item:</span> <strong id="preview-item-name"></strong></div><div></div><div class="flex justify-between"><span>Royalty Pass:</span> <strong id="preview-royalty-pass-no"></strong></div><div></div><div class="flex justify-between"><span>Driver Name:</span> <strong id="preview-driver-name"></strong></div></div><div class="text-center text-xs text-slate-600 bg-slate-100 p-2 rounded-md"><p id="preview-net-weight-words" class="capitalize font-semibold">-</p></div><div class="slip-font text-sm flex justify-between mt-4"><span>Charges:</span><strong id="preview-charges">₹0.00</strong></div><div class="flex-grow"></div><div class="grid grid-cols-2 gap-8 mt-12 pt-4 border-t border-slate-300 text-center text-xs"><div><hr class="border-slate-400 border-dashed"><p class="mt-1 font-medium text-slate-500">Operator's Signature</p></div><div><hr class="border-slate-400 border-dashed"><p class="mt-1 font-medium text-slate-500">Driver's Signature</p></div></div></div>
                 </div>
             </main>
             <!-- Saved Slips Section -->
             <div class="mt-12 mx-auto container no-print">
                 <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                     <h2 class="text-2xl font-bold text-slate-900 mb-4 border-b pb-2">Your Saved Slips</h2>
                     <div id="saved-slips-list" class="space-y-3 max-h-[40vh] overflow-y-auto pr-2">
                         <p id="slips-message" class="text-center text-slate-500 p-4">Login to see your saved slips.</p>
                     </div>
                 </div>
             </div>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyA0VLeSJ4_-h4HKU_KHCJzKK4_64GzgarU",
          authDomain: "weighbridge-f81c5.firebaseapp.com",
          projectId: "weighbridge-f81c5",
          storageBucket: "weighbridge-f81c5.firebasestorage.app",
          messagingSenderId: "475229400257",
          appId: "1:475229400257:web:45f5111d05aecc1170f840"
        };
    
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // --- DOM Elements ---
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const userEmailSpan = document.getElementById('user-email');
        
        let slipsCollectionRef; // Will be set after login
        let allSlipsData = []; 
        const form = document.getElementById('weighbridge-form');
        const formInputs = form.querySelectorAll('input');
        
        // --- App Logic (unchanged functions) ---
        function showToast(message, isError = false) { /* ... same as before ... */ const toast = document.getElementById('toast'); toast.textContent = message; toast.className = `toast show ${isError ? 'bg-red-600' : 'bg-green-600'}`; setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000); }
        const previewMapping = { 'company-name': 'preview-company-name', 'weighbridge-name': 'preview-weighbridge-name', 'serial-no': 'preview-serial-no', 'customer-name': 'preview-customer-name', 'site': 'preview-site', 'vehicle-number': 'preview-vehicle-number', 'item-name': 'preview-item-name', 'royalty-pass-no': 'preview-royalty-pass-no', 'driver-name': 'preview-driver-name', 'charges': { id: 'preview-charges', format: val => `₹${parseFloat(val || 0).toFixed(2)}` }, 'gross-weight': { id: 'preview-gross-weight', format: val => `${val || 0}` }, 'tare-weight': { id: 'preview-tare-weight', format: val => `${val || 0}` }, };
        function numberToWords(num) { /* ... same as before ... */ if (num === 0) return 'Zero'; const a = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen']; const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety']; const inWords = (n) => { let str = ''; if (n > 99) { str += a[Math.floor(n / 100)] + ' Hundred '; n %= 100; } if (n > 19) { str += b[Math.floor(n / 10)] + ' ' + a[n % 10]; } else { str += a[n]; } return str.trim(); }; let result = ''; const crore = Math.floor(num / 10000000); num %= 10000000; const lakh = Math.floor(num / 100000); num %= 100000; const thousand = Math.floor(num / 1000); num %= 1000; if (crore > 0) result += inWords(crore) + ' Crore '; if (lakh > 0) result += inWords(lakh) + ' Lakh '; if (thousand > 0) result += inWords(thousand) + ' Thousand '; if (num > 0) result += inWords(num); return result.trim().replace(/\s+/g, ' '); }
        function updateDateTimePreview() { /* ... same as before ... */ const inDate = document.getElementById('in-date').value; const inTime = document.getElementById('in-time').value; const outDate = document.getElementById('out-date').value; const outTime = document.getElementById('out-time').value; let inDateTimeStr = '-'; if (inDate) { inDateTimeStr = new Date(inDate).toLocaleDateString('en-GB'); if(inTime) inDateTimeStr += ` ${new Date(`1970-01-01T${inTime}`).toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit', hour12: true})}`; } let outDateTimeStr = '-'; if(outDate) { outDateTimeStr = new Date(outDate).toLocaleDateString('en-GB'); if(outTime) outDateTimeStr += ` ${new Date(`1970-01-01T${outTime}`).toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit', hour12: true})}`; } document.getElementById('preview-in-datetime').textContent = inDateTimeStr; document.getElementById('preview-out-datetime').textContent = outDateTimeStr; }
        function calculateNetWeight() { /* ... same as before ... */ const gross = parseFloat(document.getElementById('gross-weight').value) || 0; const tare = parseFloat(document.getElementById('tare-weight').value) || 0; const net = Math.abs(gross - tare); document.getElementById('preview-net-weight').textContent = `${net}`; document.getElementById('preview-net-weight-words').textContent = net > 0 ? `${numberToWords(net)} Kilograms Only` : '-'; }
        function updatePreviewFromForm() { /* ... same as before ... */ formInputs.forEach(input => { const target = previewMapping[input.id]; if (!target) return; const elementId = typeof target === 'string' ? target : target.id; const element = document.getElementById(elementId); if (element) { const formattedValue = typeof target.format === 'function' ? target.format(input.value) : input.value; element.textContent = formattedValue || '-'; if (input.id === 'vehicle-number') element.classList.add('uppercase'); } }); updateDateTimePreview(); calculateNetWeight(); }
        function populateForm(data) { /* ... same as before ... */ formInputs.forEach(input => { if (data[input.id] !== undefined) { input.value = data[input.id]; } }); updatePreviewFromForm(); }
        function clearFormForNewSlip() { /* ... same as before ... */ form.reset(); document.getElementById('company-name').value = "ASHAPURA ENTERPRISE"; document.getElementById('weighbridge-name').value = "Main Yard, Rajkot"; document.getElementById('serial-no').value = Math.floor(10000 + Math.random() * 90000); const now = new Date(); document.getElementById('in-date').value = now.toISOString().split('T')[0]; document.getElementById('in-time').value = now.toTimeString().split(' ')[0].substring(0, 5); updatePreviewFromForm(); }

        // --- Firebase Data Functions ---
        async function saveSlip() {
            if (!slipsCollectionRef) {
                showToast("Not logged in.", true);
                return false;
            }
            const vehicleNumber = document.getElementById('vehicle-number').value;
            if (!vehicleNumber.trim()) {
                showToast("Vehicle Number is required to save.", true);
                return false;
            }
            const slipData = {};
            formInputs.forEach(input => slipData[input.id] = input.value);
            slipData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            try {
                await slipsCollectionRef.add(slipData);
                showToast("Slip saved successfully!");
                return true;
            } catch (error) {
                console.error("Error adding document: ", error);
                showToast("Error saving slip. Check console.", true);
                return false;
            }
        }

        function fetchAndRenderSlips() {
            if (!slipsCollectionRef) return;
            slipsCollectionRef.orderBy("createdAt", "desc").onSnapshot((querySnapshot) => {
                const listElement = document.getElementById('saved-slips-list');
                listElement.innerHTML = ''; allSlipsData = [];
                if (querySnapshot.empty) { listElement.innerHTML = '<p class="text-center text-slate-500 p-4">You have no saved slips yet.</p>'; return; }
                querySnapshot.forEach((doc) => { allSlipsData.push({ id: doc.id, ...doc.data() }); });
                allSlipsData.forEach(slip => {
                    const slipCard = `<div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center p-3 bg-slate-50 rounded-lg border"><div class="font-semibold text-slate-800">#${slip['serial-no'] || 'N/A'}</div><div class="text-slate-600">${slip['customer-name'] || 'No Customer'}</div><div class="text-slate-600 uppercase">${slip['vehicle-number'] || 'No Vehicle'}</div><div class="flex items-center gap-2 justify-end"><button data-id="${slip.id}" class="load-btn text-sm bg-green-100 text-green-800 font-semibold px-3 py-1 rounded-md hover:bg-green-200">Load</button><button data-id="${slip.id}" class="view-print-btn text-sm bg-blue-100 text-blue-800 font-semibold px-3 py-1 rounded-md hover:bg-blue-200">View/Print</button></div></div>`;
                    listElement.insertAdjacentHTML('beforeend', slipCard);
                });
            }, (error) => { console.error("Error fetching slips: ", error); document.getElementById('slips-message').textContent = 'Error fetching data. Check Firebase rules.'; });
        }

        // --- Auth State Change Handler ---
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is signed in.
                authContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                userEmailSpan.textContent = user.email;

                // Set up the user-specific collection reference
                slipsCollectionRef = db.collection('users').doc(user.uid).collection('slips');
                
                fetchAndRenderSlips();
                clearFormForNewSlip();
            } else {
                // User is signed out.
                authContainer.classList.remove('hidden');
                appContainer.classList.add('hidden');
                document.getElementById('saved-slips-list').innerHTML = '<p id="slips-message" class="text-center text-slate-500 p-4">Login to see your saved slips.</p>';
            }
        });

        // --- Event Listeners ---
        // Auth form toggling
        document.getElementById('show-signup').addEventListener('click', (e) => { e.preventDefault(); loginForm.classList.add('hidden'); signupForm.classList.remove('hidden'); });
        document.getElementById('show-login').addEventListener('click', (e) => { e.preventDefault(); signupForm.classList.add('hidden'); loginForm.classList.remove('hidden'); });

        // Auth actions
        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => showToast("Account created successfully!"))
                .catch(error => showToast(error.message, true));
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => showToast(error.message, true));
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            auth.signOut();
        });

        // App actions
        document.getElementById('save-print-btn').addEventListener('click', async () => { const saved = await saveSlip(); if (saved) { setTimeout(() => window.print(), 500); } });
        document.getElementById('new-slip-btn').addEventListener('click', clearFormForNewSlip);
        document.getElementById('saved-slips-list').addEventListener('click', (e) => { const slipId = e.target.dataset.id; if (!slipId) return; const slipData = allSlipsData.find(s => s.id === slipId); if (!slipData) return; if (e.target.classList.contains('load-btn')) { populateForm(slipData); window.scrollTo({ top: 0, behavior: 'smooth' }); } else if (e.target.classList.contains('view-print-btn')) { populateForm(slipData); setTimeout(() => window.print(), 100); } });
        form.addEventListener('input', updatePreviewFromForm);
    </script>
</body>
</html>


