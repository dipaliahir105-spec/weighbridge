<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weighbridge Software - Dual Print</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .slip-font { font-family: 'Roboto Mono', monospace; }
        #saved-slips-list::-webkit-scrollbar { width: 8px; }
        #saved-slips-list::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        #saved-slips-list::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        #saved-slips-list::-webkit-scrollbar-thumb:hover { background: #555; }
        input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(0.6); }
        .toast { visibility: hidden; min-width: 250px; margin-left: -125px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 50; left: 50%; bottom: 30px; opacity: 0; transition: opacity 0.5s, visibility 0.5s; }
        .toast.show { visibility: visible; opacity: 1; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 40; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        
        /* New Styles for Dual Slip */
        .single-slip {
            border: 2px dashed #ccc;
            padding: 15px;
            display: flex;
            flex-direction: column;
            page-break-inside: avoid;
        }

        @media print {
            body * { visibility: hidden; }
            #slip-preview-container, #slip-preview-container * { 
                visibility: visible; 
            }
            #slip-preview-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                padding: 10mm;
                box-sizing: border-box;
                margin: 0;
                border: none !important;
                box-shadow: none !important;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
            }
            .single-slip {
                height: 47%; /* Each slip takes up about half the page */
                border: 1px solid #000;
                padding: 15px;
                box-sizing: border-box;
            }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- Authentication Container (No Changes) -->
    <div id="auth-container" class="min-h-screen flex items-center justify-center">
        <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-lg">
            <form id="login-form"><h2 class="text-3xl font-bold text-center text-slate-800 mb-2">Welcome Back!</h2><p class="text-center text-slate-500 mb-6">Sign in to continue</p><div class="space-y-4"><input type="email" id="login-email" placeholder="Email" required class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"><input type="password" id="login-password" placeholder="Password" required class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"></div><button type="submit" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-all">Login</button><p class="text-center text-sm text-slate-500 mt-4">Don't have an account? <a href="#" id="show-signup" class="font-semibold text-blue-600 hover:underline">Sign Up</a></p></form>
            <form id="signup-form" class="hidden"><h2 class="text-3xl font-bold text-center text-slate-800 mb-2">Create Account</h2><p class="text-center text-slate-500 mb-6">Get started with your weighbridge app</p><div class="space-y-4"><input type="email" id="signup-email" placeholder="Email" required class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"><input type="password" id="signup-password" placeholder="Password (min. 6 characters)" required class="w-full p-3 bg-slate-50 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"></div><button type="submit" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-all">Sign Up</button><p class="text-center text-sm text-slate-500 mt-4">Already have an account? <a href="#" id="show-login" class="font-semibold text-blue-600 hover:underline">Login</a></p></form>
        </div>
    </div>
    
    <!-- Main App Container (No Changes) -->
    <div id="app-container" class="hidden">
        <header class="bg-white shadow-md p-4 no-print">
            <div class="container mx-auto flex justify-between items-center">
                <p class="text-sm">Logged in as: <strong id="user-email" class="text-slate-700"></strong></p>
                <button id="logout-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 transition-all text-sm">Logout</button>
            </div>
        </header>
        <div class="container mx-auto p-4 md:p-8">
             <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Input Form (No Changes) -->
                 <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg no-print">
                     <form id="weighbridge-form" class="space-y-6"><input type="hidden" id="editing-slip-id"><div id="form-mode-indicator" class="p-3 bg-yellow-100 text-yellow-800 rounded-lg text-center font-semibold hidden">You are currently editing an existing slip.</div><div><h3 class="text-lg font-semibold border-b pb-2 mb-4 text-slate-700">Company & Weighbridge</h3><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><input type="text" id="company-name" placeholder="Your Company Name" class="w-full p-3 bg-slate-50 rounded-lg border" value="ASHAPURA ENTERPRISE"><input type="text" id="weighbridge-name" placeholder="Weighbridge Name/Location" class="w-full p-3 bg-slate-50 rounded-lg border" value="Main Yard, Rajkot"></div></div><div><h3 class="text-lg font-semibold border-b pb-2 mb-4 text-slate-700">Slip & Time Details</h3><div class="grid grid-cols-2 sm:grid-cols-4 gap-4"><div class="col-span-2 sm:col-span-4"><label for="serial-no" class="text-sm font-medium">Serial No / DC No.</label><input type="text" id="serial-no" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border"></div><div><label for="in-date" class="text-sm font-medium">In Date</label><input type="date" id="in-date" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border"></div><div><label for="in-time" class="text-sm font-medium">In Time</label><input type="time" id="in-time" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border"></div><div><label for="out-date" class="text-sm font-medium">Out Date</label><input type="date" id="out-date" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border"></div><div><label for="out-time" class="text-sm font-medium">Out Time</label><input type="time" id="out-time" class="w-full mt-1 p-3 bg-slate-50 rounded-lg border"></div></div></div><div><h3 class="text-lg font-semibold border-b pb-2 mb-4 text-slate-700">Transaction Details</h3><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><input type="text" id="customer-name" placeholder="Customer Name" class="sm:col-span-2 w-full p-3 bg-slate-50 rounded-lg border"><input type="text" id="site" placeholder="Site" class="w-full p-3 bg-slate-50 rounded-lg border"><input type="text" id="vehicle-number" placeholder="Vehicle Number" class="w-full p-3 bg-slate-50 rounded-lg border"><input type="text" id="item-name" placeholder="Item/Material" class="w-full p-3 bg-slate-50 rounded-lg border"><input type="text" id="royalty-pass-no" placeholder="Royalty Pass No." class="w-full p-3 bg-slate-50 rounded-lg border"><input type="text" id="driver-name" placeholder="Driver's Name" class="w-full p-3 bg-slate-50 rounded-lg border"><input type="number" id="charges" placeholder="Weighment Charges (₹)" class="w-full p-3 bg-slate-50 rounded-lg border"></div></div><div><h3 class="text-lg font-semibold border-b pb-2 mb-4 text-slate-700">Weight Details (in KG)</h3><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><input type="number" id="gross-weight" placeholder="Gross Weight" class="w-full p-3 bg-slate-50 rounded-lg border"><input type="number" id="tare-weight" placeholder="Tare Weight" class="w-full p-3 bg-slate-50 rounded-lg border"></div></div><div class="pt-4 grid grid-cols-2 gap-4"><button type="button" id="new-slip-btn" class="w-full bg-slate-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-600">New Slip</button><button type="button" id="save-update-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2"></button></div></form>
                 </div>
                
                <!-- Slip Preview Section - MODIFIED -->
                <div id="slip-preview-container" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border-0 space-y-8">
                    <!-- Original Copy -->
                    <div class="single-slip">
                        <div class="text-center">
                            <h2 class="preview-company-name text-2xl font-bold text-slate-900">ASHAPURA ENTERPRISE</h2>
                            <p class="preview-weighbridge-name text-sm text-slate-500">Main Yard, Rajkot</p>
                        </div>
                        <div class="flex justify-between items-center mt-2 border-y-2 border-black py-1"><h3 class="text-md font-bold">WEIGHMENT SLIP</h3><p class="text-xs font-semibold">Original Copy</p></div>
                        <div class="slip-font text-sm grid grid-cols-2 gap-x-4 mt-2 border-b border-black pb-2"><div><div class="flex justify-between pr-4"><span>Serial No:</span><strong class="preview-serial-no"></strong></div></div><div class="space-y-1"><div class="flex justify-between"><span class="pr-2">In Date/Time:</span><strong class="preview-in-datetime"></strong></div><div class="flex justify-between"><span class="pr-2">Out Date/Time:</span><strong class="preview-out-datetime"></strong></div></div></div>
                        <div class="slip-font text-sm grid grid-cols-2 gap-x-8 gap-y-1 my-2 py-2 border-b border-black"><div class="flex justify-between"><span>Customer:</span> <strong class="preview-customer-name"></strong></div><div class="flex justify-between"><span>Gross (KG):</span> <strong class="preview-gross-weight text-lg">0</strong></div><div class="flex justify-between"><span>Site:</span> <strong class="preview-site"></strong></div><div class="flex justify-between"><span>Tare (KG):</span> <strong class="preview-tare-weight text-lg">0</strong></div><div class="flex justify-between"><span>Vehicle No:</span> <strong class="preview-vehicle-number uppercase"></strong></div><div class="flex justify-between border-t border-dashed pt-1"><span>Net (KG):</span> <strong class="preview-net-weight text-xl">0</strong></div><div class="flex justify-between"><span>Item:</span> <strong class="preview-item-name"></strong></div><div></div><div class="flex justify-between"><span>Royalty Pass:</span> <strong class="preview-royalty-pass-no"></strong></div><div></div><div class="flex justify-between"><span>Driver Name:</span> <strong class="preview-driver-name"></strong></div></div>
                        <div class="text-center text-xs text-slate-600 bg-slate-100 p-2 rounded-md"><p class="preview-net-weight-words capitalize font-semibold">-</p></div>
                        <div class="slip-font text-sm flex justify-between mt-4"><span>Charges:</span><strong class="preview-charges">₹0.00</strong></div>
                        <div class="flex-grow"></div>
                        <div class="grid grid-cols-2 gap-8 mt-12 pt-4 border-t border-slate-300 text-center text-xs"><div><hr class="border-slate-400 border-dashed"><p class="mt-1 font-medium text-slate-500">Operator's Signature</p></div><div><hr class="border-slate-400 border-dashed"><p class="mt-1 font-medium text-slate-500">Driver's Signature</p></div></div>
                    </div>

                    <!-- Customer Copy -->
                    <div class="single-slip">
                        <div class="text-center">
                            <h2 class="preview-company-name text-2xl font-bold text-slate-900">ASHAPURA ENTERPRISE</h2>
                            <p class="preview-weighbridge-name text-sm text-slate-500">Main Yard, Rajkot</p>
                        </div>
                        <div class="flex justify-between items-center mt-2 border-y-2 border-black py-1"><h3 class="text-md font-bold">WEIGHMENT SLIP</h3><p class="text-xs font-semibold">Customer Copy</p></div>
                        <div class="slip-font text-sm grid grid-cols-2 gap-x-4 mt-2 border-b border-black pb-2"><div><div class="flex justify-between pr-4"><span>Serial No:</span><strong class="preview-serial-no"></strong></div></div><div class="space-y-1"><div class="flex justify-between"><span class="pr-2">In Date/Time:</span><strong class="preview-in-datetime"></strong></div><div class="flex justify-between"><span class="pr-2">Out Date/Time:</span><strong class="preview-out-datetime"></strong></div></div></div>
                        <div class="slip-font text-sm grid grid-cols-2 gap-x-8 gap-y-1 my-2 py-2 border-b border-black"><div class="flex justify-between"><span>Customer:</span> <strong class="preview-customer-name"></strong></div><div class="flex justify-between"><span>Gross (KG):</span> <strong class="preview-gross-weight text-lg">0</strong></div><div class="flex justify-between"><span>Site:</span> <strong class="preview-site"></strong></div><div class="flex justify-between"><span>Tare (KG):</span> <strong class="preview-tare-weight text-lg">0</strong></div><div class="flex justify-between"><span>Vehicle No:</span> <strong class="preview-vehicle-number uppercase"></strong></div><div class="flex justify-between border-t border-dashed pt-1"><span>Net (KG):</span> <strong class="preview-net-weight text-xl">0</strong></div><div class="flex justify-between"><span>Item:</span> <strong class="preview-item-name"></strong></div><div></div><div class="flex justify-between"><span>Royalty Pass:</span> <strong class="preview-royalty-pass-no"></strong></div><div></div><div class="flex justify-between"><span>Driver Name:</span> <strong class="preview-driver-name"></strong></div></div>
                        <div class="text-center text-xs text-slate-600 bg-slate-100 p-2 rounded-md"><p class="preview-net-weight-words capitalize font-semibold">-</p></div>
                        <div class="slip-font text-sm flex justify-between mt-4"><span>Charges:</span><strong class="preview-charges">₹0.00</strong></div>
                        <div class="flex-grow"></div>
                        <div class="grid grid-cols-2 gap-8 mt-12 pt-4 border-t border-slate-300 text-center text-xs"><div><hr class="border-slate-400 border-dashed"><p class="mt-1 font-medium text-slate-500">Operator's Signature</p></div><div><hr class="border-slate-400 border-dashed"><p class="mt-1 font-medium text-slate-500">Driver's Signature</p></div></div>
                    </div>
                </div>
             </main>
             <!-- Saved Slips Section (No Changes) -->
             <div class="mt-12 mx-auto container no-print">
                 <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg"><h2 class="text-2xl font-bold text-slate-900 mb-4 border-b pb-2">Your Saved Slips</h2><div id="saved-slips-list" class="space-y-3 max-h-[40vh] overflow-y-auto pr-2"><p id="slips-message" class="text-center text-slate-500 p-4">Login to see your saved slips.</p></div></div>
             </div>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>

    <!-- Delete Confirmation Modal (No Changes) -->
    <div id="delete-modal" class="modal-overlay">
        <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-sm text-center"><h3 class="text-xl font-bold text-slate-800">Are you sure?</h3><p class="text-slate-500 mt-2 mb-6">Do you really want to delete this slip? This action cannot be undone.</p><div class="grid grid-cols-2 gap-4"><button id="cancel-delete-btn" class="bg-slate-200 text-slate-800 font-bold py-3 rounded-lg hover:bg-slate-300">Cancel</button><button id="confirm-delete-btn" class="bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700">Delete</button></div></div>
    </div>

    <!-- Firebase SDKs (No Changes) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // --- Firebase Init & DOM Elements (No Changes) ---
        const firebaseConfig = { apiKey: "AIzaSyA0VLeSJ4_-h4HKU_KHCJzKK4_64GzgarU", authDomain: "weighbridge-f81c5.firebaseapp.com", projectId: "weighbridge-f81c5", storageBucket: "weighbridge-f81c5.firebasestorage.app", messagingSenderId: "475229400257", appId: "1:475229400257:web:45f5111d05aecc1170f840" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const authContainer = document.getElementById('auth-container'); const appContainer = document.getElementById('app-container'); const loginForm = document.getElementById('login-form'); const signupForm = document.getElementById('signup-form'); const userEmailSpan = document.getElementById('user-email'); const editingSlipIdInput = document.getElementById('editing-slip-id'); const saveUpdateBtn = document.getElementById('save-update-btn'); const formModeIndicator = document.getElementById('form-mode-indicator'); const deleteModal = document.getElementById('delete-modal'); const confirmDeleteBtn = document.getElementById('confirm-delete-btn'); const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        let slipsCollectionRef; let allSlipsData = []; const form = document.getElementById('weighbridge-form'); const formInputs = form.querySelectorAll('input');

        // --- Utility Functions (No Changes) ---
        function showToast(message, isError = false) { const toast = document.getElementById('toast'); toast.textContent = message; toast.className = `toast show ${isError ? 'bg-red-600' : 'bg-green-600'}`; setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000); }
        function numberToWords(num) { if (num === 0) return 'Zero'; const a = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen']; const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety']; const inWords = (n) => { let str = ''; if (n > 99) { str += a[Math.floor(n / 100)] + ' Hundred '; n %= 100; } if (n > 19) { str += b[Math.floor(n / 10)] + ' ' + a[n % 10]; } else { str += a[n]; } return str.trim(); }; let result = ''; const crore = Math.floor(num / 10000000); num %= 10000000; const lakh = Math.floor(num / 100000); num %= 100000; const thousand = Math.floor(num / 1000); num %= 1000; if (crore > 0) result += inWords(crore) + ' Crore '; if (lakh > 0) result += inWords(lakh) + ' Lakh '; if (thousand > 0) result += inWords(thousand) + ' Thousand '; if (num > 0) result += inWords(num); return result.trim().replace(/\s+/g, ' '); }
        
 
